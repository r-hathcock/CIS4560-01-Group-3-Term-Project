--ALL COMMANDS USED WITH EXPLANATIONS
--do these commands from sql editor before transferring to linux fs

--remove columns
alter table May2015
drop column created_utc, link_id, score_hidden, author_flair_css_class,
author_flair_text,
removal_reason, archived, retrieved_on, edited, controversiality,
parent_id;

--remove non default subreddits excluding announcements
delete from May2015
where not subreddit='Art'
and not subreddit='AskReddit'
and not subreddit='askscience'
and not subreddit='aww'
and not subreddit='blog'
and not subreddit='books'
and not subreddit='creepy'
and not subreddit='dataisbeautiful'
and not subreddit='DIY'
and not subreddit='Documentaries'
and not subreddit='EarthPorn'
and not subreddit='explainlikeimfive'
and not subreddit='food'
and not subreddit='funny'
and not subreddit='Futurology'
and not subreddit='gadgets'
and not subreddit='gaming'
and not subreddit='GetMotivated'
and not subreddit='gifs'
and not subreddit='history'
and not subreddit='IAmA'
and not subreddit='InternetIsBeautiful'
and not subreddit='Jokes'
and not subreddit='LifeProTips'
and not subreddit='listentothis'
and not subreddit='mildlyinteresting'
and not subreddit='movies'
and not subreddit='Music'
and not subreddit='news'
and not subreddit='nosleep'
and not subreddit='nottheonion'
and not subreddit='OldSchoolCool'
and not subreddit='personalfinance'
and not subreddit='philosophy'
and not subreddit='photoshopbattles'
and not subreddit='pics'
and not subreddit='science'
and not subreddit='Showerthoughts'
and not subreddit='space'
and not subreddit='sports'
and not subreddit='television'
and not subreddit='tifu'
and not subreddit='todayilearned'
and not subreddit='UpliftingNews'
and not subreddit='videos'
and not subreddit='worldnews';

--check count should be 46
select count(distinct subreddit) from May2015;

--optional double check
select distinct subreddit from May2015;

--remove all rows where comment body is [deleted]
delete from May2015 where body='[deleted]';

--upload file to linux server
scp may_2015_trim.csv dkang10@129.150.64.74:/home/dkang10

--create hdfs directory
hdfs dfs -mkdir group3
hdfs dfs -mkdir group3/dataset

--check directory was made
hdfs dfs -ls group3

--put file in hdfs
hdfs dfs -put may_2015_trim.csv group3/dataset

--check file in hdfs
hdfs dfs -ls group3/dataset

--change permissions of new directory
hdfs dfs -chmod -R o+w .

--create external table from csv file in hdfs
create external table may_2015 (
 id string,
 subreddit_id string,
 subreddit string,
 name string,
 author string,
 ups int,
 downs int,
 score int,
 gilted int,
 distinguished string,
 body string
)
row format delimited
fields terminated by '|'
lines terminated by '\n'
location '/user/dkang10/group3/dataset'
tblproperties('skip.header.line.count'='1');

--check new table
show tables;
describe may_2015;
select count(*) from may_2015;

--clean table from csv and text box errors
create table may_2015_a as
select id, subreddit_id, subreddit, name, author, ups, downs, score,
gilted, distinguished, body from may_2015
where subreddit='Art'
or subreddit='AskReddit'
or subreddit='askscience'
or subreddit='aww'
or subreddit='blog'
or subreddit='books'
or subreddit='creepy'
or subreddit='dataisbeautiful'
or subreddit='DIY'
or subreddit='Documentaries'
or subreddit='EarthPorn'
or subreddit='explainlikeimfive'
or subreddit='food'
or subreddit='funny'
or subreddit='Futurology'
or subreddit='gadgets'
or subreddit='gaming'
or subreddit='GetMotivated'
or subreddit='gifs'
or subreddit='history'
or subreddit='IAmA'
or subreddit='InternetIsBeautiful'
or subreddit='Jokes'
or subreddit='LifeProTips'
or subreddit='listentothis'
or subreddit='mildlyinteresting'
or subreddit='movies'
or subreddit='Music'
or subreddit='news'
or subreddit='nosleep'
or subreddit='nottheonion'
or subreddit='OldSchoolCool'
or subreddit='personalfinance'
or subreddit='philosophy'
or subreddit='photoshopbattles'
or subreddit='pics'
or subreddit='science'
or subreddit='Showerthoughts'
or subreddit='space'
or subreddit='sports'
or subreddit='television'
or subreddit='tifu'
or subreddit='todayilearned'
or subreddit='UpliftingNews'
or subreddit='videos'
or subreddit='worldnews';

--general analysis begins~~~~~~~~~~~~~~~~~~~~
--query comments with highest upvotes across default subreddits
select subreddit, ups, downs, score, body from may_2015_a
order by score desc limit 25;

--observation: many top upvoted comments are from askreddit
--query number of comments per subreddit
select subreddit, count(score) as count from may_2015_a
group by subreddit order by count desc;

--observation: askreddit has over 5x the largest comment participation
over the next largest subreddit

--query average upvote per comment per subreddit
select subreddit, avg(score) as avg_score from may_2015_a
group by subreddit order by avg_score desc;

--observation: surprisingly askreddit is in 4th place, maybe due to sheer
comment volume and not enough upvote distribution
--photoshopbattles comments are each tailor made and more impactful
--IAmA comments consist of questions asked to high profile people who only
respond within a pre determined time frame
--gifs has more upvote participation likely due to its lesser comment
participation so it has less throwaway comments
--see most common 2 word combinations
select explode(ngrams(sentences(lower(body)), 2, 50)) as two from
may_2015_a;

--results are mostly prepositions, articles and generally results of
english grammar
--see most common 3 word combinations
select explode(ngrams(sentences(lower(body)), 3, 50)) as three from
may_2015_a;

--top phrase by almost 2x occurrence is "a lot of"
--youtube links are also the third most common
--see most common 4 word combinations
select explode(ngrams(sentences(lower(body)), 4, 50)) as four from
may_2015_a;

--the most frequent longer phrases appear to be administrative comments..
--see most common 5 word combinations
select explode(ngrams(sentences(lower(body)), 5, 50)) as five from
may_2015_a;

--same situation here..
--see subreddit source and full comment of most frequent 4phrase
select subreddit, author, distinguished, score, body from may_2015_a
where lower(body) like '%has been automatically removed%' limit 25;

--most frequently occurring 4-5 word phrases are from moderator bots
--see subreddit source and full comment of most frequent 5phrase
select subreddit, author, distinguished, score, body from may_2015_a
where lower(body) like '%its entirety before taking action%' limit 25;

--most frequently occurring 4-5 word phrases are from moderator bots
--remove all rows made by moderator bots because their canned messages
dominate the ngrams >4
create table may_2015_b as
select id, subreddit_id, subreddit, name, author, ups, downs, score,
gilted, distinguished, body from may_2015_a
where not distinguished='moderator';

--most common 4 word combinations from actual users
select explode(ngrams(sentences(lower(body)), 4, 50)) as four from
may_2015_b;

--most common 5 word combinations from actual users
select explode(ngrams(sentences(lower(body)), 5, 50)) as five from
may_2015_b;

--several phrases seem to stand out here and their slight variations
suggest they are memes or highly referenced topics
--"i am a beautiful person" and its variations
--"i am so i am" and its variations
--"the best way to get"
--"a good time to time"
--search for "i am a beautiful person" with top rated comments
select subreddit, author, distinguished, score, body from may_2015_b
where lower(body) like '%i am a beautiful person%'
order by score desc limit 30;

--phrase seems to preface repetitive, absurd, out of context statements
--search for "i am so i am"
select subreddit, author, distinguished, score, body from may_2015_b
where lower(body) like '%i am so i am%'
order by score desc limit 30;

--phrase seems to be used repetitively "i am so" and related to new york
--search for "the best way to get"
select subreddit, author, distinguished, score, body from may_2015_b
where lower(body) like '%the best way to get%'
order by score desc limit 30;

--just a really common phrase used everywhere
--search for "a good time to time"
select subreddit, author, distinguished, score, body from may_2015_b
where lower(body) like '%a good time to time%'
order by score desc limit 30;

--comments are largely nonsensical and some appear alongside “i am a
beautiful person”
AFTER SOME RESEARCH, 3/4 PHRASES ARE FROM USERS REPEATEDLY PRESSING THE
SUGGESTED WORD ON THEIR ANDROID BASED PHONE KEYBOARD
https://www.reddit.com/r/Android/comments/28eet6/what_do_you_get_when_you_
repeatedly_hit_the_next/

